language: go
sudo: false
go:
- 1.15.2
os: linux
dist: focal
services:
- postgresql
addons:
  ssh_known_hosts: 95.163.209.195
  postgresql: '10'
  apt:
    packages:
    - postgresql
    - postgresql-client
install:
- go get -u -t -v ./...
before_script:
- sudo service postgresql start
- psql -c 'create database maila;' -U postgres
- psql -c "ALTER USER postgres WITH PASSWORD '987654321';" -U postgres
before_install:
- pwd
- ls
- openssl aes-256-cbc -K $encrypted_a626daabe3df_key -iv $encrypted_a626daabe3df_iv
  -in .travis/deploy_key.enc -out .travis/deploy_key -d

before_deploy:
- echo before Deploy
- cd ..
- pwd
- mv ${TRAVIS_BUILD_DIR}/.travis/deploy_key ~/.ssh/id_rsa
- cat ${TRAVIS_BUILD_DIR}/.travis/ssh_config >> ~/.ssh/config
script:
- go mod vendor
- golangci-lint run
- cd cmd
- echo TRAIS BULD DIR
- echo $TRAVIS_BUILD_DIR
deploy:
  skip_cleanup: false
  provider: script
  script: "./.travis/deploy.sh"
  on:
    branch: CI
